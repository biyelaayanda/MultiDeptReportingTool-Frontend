<div class="executive-dashboard">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h1 class="dashboard-title">
          <i class="fas fa-chart-line text-primary"></i>
          Executive Dashboard
        </h1>
        <p class="text-muted">Real-time insights and analytics</p>
      </div>
      <div class="col-md-6 text-end">
        <div class="dashboard-actions">
          <div class="btn-group me-2">
            <select class="form-select" [(ngModel)]="selectedTimeframe" (change)="onTimeframeChange()">
              <option value="7d">Last 7 Days</option>
              <option value="30d">Last 30 Days</option>
              <option value="90d">Last 90 Days</option>
              <option value="1y">Last Year</option>
            </select>
          </div>
          <div class="btn-group me-2">
            <button class="btn btn-outline-primary" (click)="refreshDashboard()" [disabled]="isLoading">
              <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
              Refresh
            </button>
          </div>
          <div class="btn-group">
            <button 
              class="btn btn-success dropdown-toggle" 
              type="button" 
              data-bs-toggle="dropdown" 
              [disabled]="isExporting"
              aria-expanded="false">
              <i class="fas fa-download" *ngIf="!isExporting"></i>
              <i class="fas fa-spinner fa-spin" *ngIf="isExporting"></i>
              <span *ngIf="!isExporting">Export</span>
              <span *ngIf="isExporting">Exporting {{ exportingFormat }}...</span>
            </button>
            <ul class="dropdown-menu">
              <li><button 
                class="dropdown-item" 
                (click)="exportDashboard(ExportFormats.PDF)"
                [disabled]="isExporting">
                <i class="fas fa-file-pdf text-danger"></i> Export as PDF
              </button></li>
              <li><button 
                class="dropdown-item" 
                (click)="exportDashboard(ExportFormats.CSV)"
                [disabled]="isExporting">
                <i class="fas fa-file-csv text-info"></i> Export as CSV
              </button></li>
              <li><button 
                class="dropdown-item" 
                (click)="exportDashboard(ExportFormats.JSON)"
                [disabled]="isExporting">
                <i class="fas fa-code text-secondary"></i> Export as JSON
              </button></li>
              <li><hr class="dropdown-divider"></li>
              <li><button 
                class="dropdown-item" 
                (click)="exportDashboard(ExportFormats.PowerPoint)"
                [disabled]="isExporting">
                <i class="fas fa-file-powerpoint text-warning"></i> Export as PowerPoint
              </button></li>
            </ul>
          </div>
        </div>
        <small class="text-muted d-block mt-2">
          Last updated: {{ lastRefresh | date:'short' }}
        </small>
      </div>
    </div>

    <!-- Export Notification Area -->
    <div class="row" *ngIf="exportNotification">
      <div class="col-12">
        <div class="alert alert-dismissible fade show mb-3" 
             [ngClass]="{
               'alert-success': exportNotification.type === 'success',
               'alert-danger': exportNotification.type === 'error',
               'alert-info': exportNotification.type === 'info'
             }">
          <i class="fas" 
             [ngClass]="{
               'fa-check-circle': exportNotification.type === 'success',
               'fa-exclamation-triangle': exportNotification.type === 'error',
               'fa-info-circle': exportNotification.type === 'info'
             }"></i>
          {{ exportNotification.message }}
          <button type="button" 
                  class="btn-close" 
                  (click)="clearNotification()" 
                  aria-label="Close"></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && !dashboardData" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading dashboard data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle"></i>
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="refreshDashboard()">
      Try Again
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="dashboardData && !error" class="dashboard-content">
    
    <!-- KPI Cards Row -->
    <div class="row mb-4">
      <div class="col-md-2" *ngFor="let kpi of topKpis">
        <div class="card kpi-card h-100">
          <div class="card-body text-center">
            <div class="kpi-icon mb-2">
              <i class="fas fa-chart-bar text-primary"></i>
            </div>
            <h3 class="kpi-value mb-1" [class]="getKpiTrendColor(kpi)">
              {{ kpi.value | number:'1.0-2' }}
              <small class="kpi-unit">{{ kpi.unit }}</small>
            </h3>
            <p class="kpi-label text-muted mb-2">{{ kpi.name }}</p>
            <div class="kpi-trend">
              <i [class]="getTrendIcon(kpi.trend)"></i>
              <span [class]="getKpiTrendColor(kpi)">
                {{ kpi.changePercentage | number:'1.1-1' }}%
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Analytics Row -->
    <div class="row mb-4">
      <!-- Company Overview -->
      <div class="col-lg-4 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-building text-info"></i>
              Company Overview
            </h5>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-6 mb-3">
                <div class="metric-box">
                  <h4 class="text-primary">{{ dashboardData.companyOverview.totalReports }}</h4>
                  <small class="text-muted">Total Reports</small>
                </div>
              </div>
              <div class="col-6 mb-3">
                <div class="metric-box">
                  <h4 class="text-success">{{ dashboardData.companyOverview.overallEfficiency | number:'1.1-1' }}%</h4>
                  <small class="text-muted">Completion Rate</small>
                </div>
              </div>
              <div class="col-6 mb-3">
                <div class="metric-box">
                  <h4 class="text-info">{{ dashboardData.companyOverview.totalDepartments }}</h4>
                  <small class="text-muted">Departments</small>
                </div>
              </div>
              <div class="col-6 mb-3">
                <div class="metric-box">
                  <h4 class="text-warning">{{ dashboardData.companyOverview.activeUsers }}</h4>
                  <small class="text-muted">Active Users</small>
                </div>
              </div>
            </div>
            
            <!-- Completion Rate Chart -->
            <div class="chart-container mt-3" *ngIf="completionRateChart">
              <app-chart [chartConfig]="completionRateChart"></app-chart>
            </div>
          </div>
        </div>
      </div>

      <!-- Department Performance -->
      <div class="col-lg-8 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-chart-bar text-success"></i>
              Department Performance
            </h5>
          </div>
          <div class="card-body">
            <div class="chart-container" *ngIf="departmentPerformanceChart">
              <app-chart [chartConfig]="departmentPerformanceChart"></app-chart>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Trends and Alerts Row -->
    <div class="row mb-4">
      <!-- Recent Trends -->
      <div class="col-lg-8 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-line-chart text-primary"></i>
              Recent Trends
            </h5>
          </div>
          <div class="card-body">
            <div class="chart-container" *ngIf="trendsChart">
              <app-chart [chartConfig]="trendsChart"></app-chart>
            </div>
          </div>
        </div>
      </div>

      <!-- Critical Alerts -->
      <div class="col-lg-4 mb-4">
        <div class="card h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              <i class="fas fa-exclamation-triangle text-danger"></i>
              Critical Alerts
            </h5>
            <span class="badge bg-danger">{{ criticalAlerts.length }}</span>
          </div>
          <div class="card-body p-0">
            <div class="alerts-list">
              <div *ngIf="criticalAlerts.length === 0" class="text-center p-4 text-muted">
                <i class="fas fa-check-circle text-success fa-2x mb-2"></i>
                <p>No critical alerts</p>
              </div>
              <div *ngFor="let alert of criticalAlerts.slice(0, 5)" 
                   class="alert-item p-3 border-bottom" 
                   [class.alert-read]="alert.isRead"
                   (click)="markAlertAsRead(alert)">
                <div class="d-flex align-items-start">
                  <i [class]="getAlertIcon(alert.severity)" class="me-2 mt-1"></i>
                  <div class="flex-grow-1">
                    <h6 class="alert-title mb-1">{{ alert.title }}</h6>
                    <p class="alert-message text-muted mb-1">{{ alert.message }}</p>
                    <small class="alert-meta text-muted">
                      {{ alert.department }} • {{ alert.createdAt | date:'short' }}
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Performers and System Health -->
    <div class="row mb-4">
      <!-- Top Performers -->
      <div class="col-lg-6 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-trophy text-warning"></i>
              Top Performers
            </h5>
          </div>
          <div class="card-body">
            <div class="performers-list">
              <div *ngFor="let performer of dashboardData.topPerformers.slice(0, 5); let i = index" 
                   class="performer-item d-flex align-items-center mb-3">
                <div class="rank-badge me-3">
                  <span class="badge" [class]="i === 0 ? 'bg-warning' : i === 1 ? 'bg-secondary' : i === 2 ? 'bg-info' : 'bg-light text-dark'">
                    {{ performer.rank }}
                  </span>
                </div>
                <div class="flex-grow-1">
                  <h6 class="performer-name mb-1">{{ performer.userName }}</h6>
                  <small class="text-muted">{{ performer.departmentName }}</small>
                </div>
                <div class="text-end">
                  <div class="performer-metric">
                    <strong>{{ performer.completedReports }}</strong>
                    <small class="text-muted d-block">reports</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- System Health -->
      <div class="col-lg-6 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-heartbeat text-danger"></i>
              System Health
            </h5>
          </div>
          <div class="card-body">
            <div class="health-metrics">
              <div class="health-item d-flex justify-content-between align-items-center mb-3">
                <span>Overall Health</span>
                <span class="badge" [class]="'bg-' + (dashboardData.systemHealth.overallHealth === 'Healthy' ? 'success' : 'warning')">
                  {{ dashboardData.systemHealth.overallHealth }}
                </span>
              </div>
              <div class="health-item d-flex justify-content-between align-items-center mb-3">
                <span>Database</span>
                <span class="badge" [class]="'bg-' + (dashboardData.systemHealth.databaseHealth === 'Healthy' ? 'success' : 'warning')">
                  {{ dashboardData.systemHealth.databaseHealth }}
                </span>
              </div>
              <div class="health-item d-flex justify-content-between align-items-center mb-3">
                <span>API Health</span>
                <span class="badge" [class]="'bg-' + (dashboardData.systemHealth.apiHealth === 'Healthy' ? 'success' : 'warning')">
                  {{ dashboardData.systemHealth.apiHealth }}
                </span>
              </div>
              <div class="health-item d-flex justify-content-between align-items-center mb-3">
                <span>Email Service</span>
                <span class="badge" [class]="'bg-' + (dashboardData.systemHealth.emailServiceHealth === 'Healthy' ? 'success' : 'warning')">
                  {{ dashboardData.systemHealth.emailServiceHealth }}
                </span>
              </div>
              <hr>
              <div class="health-stats">
                <div class="row text-center">
                  <div class="col-4">
                    <h6 class="text-primary">{{ dashboardData.systemHealth.uptime | number:'1.1-1' }}%</h6>
                    <small class="text-muted">Uptime</small>
                  </div>
                  <div class="col-4">
                    <h6 class="text-success">{{ dashboardData.systemHealth.responseTime }}ms</h6>
                    <small class="text-muted">Response</small>
                  </div>
                  <div class="col-4">
                    <h6 class="text-warning">{{ dashboardData.systemHealth.errorRate | number:'1.2-2' }}%</h6>
                    <small class="text-muted">Error Rate</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Business Intelligence Section -->
    <div class="row" *ngIf="businessIntelligence">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-brain text-info"></i>
              Business Intelligence Insights
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Insights -->
              <div class="col-lg-4 mb-3">
                <h6 class="text-primary">Key Insights</h6>
                <div *ngFor="let insight of businessIntelligence.insights.slice(0, 3)" class="insight-item mb-2">
                  <div class="d-flex align-items-start">
                    <i class="fas fa-lightbulb text-warning me-2 mt-1"></i>
                    <div>
                      <strong>{{ insight.title }}</strong>
                      <p class="text-muted mb-0 small">{{ insight.description }}</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recommendations -->
              <div class="col-lg-4 mb-3">
                <h6 class="text-success">Recommendations</h6>
                <div *ngFor="let rec of businessIntelligence.recommendations.slice(0, 3)" class="recommendation-item mb-2">
                  <div class="d-flex align-items-start">
                    <i class="fas fa-star text-success me-2 mt-1"></i>
                    <div>
                      <strong>{{ rec.title }}</strong>
                      <p class="text-muted mb-0 small">{{ rec.description }}</p>
                      <span class="badge badge-sm" [class]="'bg-' + (rec.priority === 'High' ? 'danger' : rec.priority === 'Medium' ? 'warning' : 'secondary')">
                        {{ rec.priority }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Predictions -->
              <div class="col-lg-4 mb-3">
                <h6 class="text-info">Predictions</h6>
                <div *ngFor="let pred of businessIntelligence.predictions.slice(0, 3)" class="prediction-item mb-2">
                  <div class="d-flex align-items-start">
                    <i class="fas fa-crystal-ball text-info me-2 mt-1"></i>
                    <div>
                      <strong>{{ pred.metric }}</strong>
                      <p class="text-muted mb-0 small">
                        Expected: {{ pred.predictedValue | number:'1.0-2' }} 
                        ({{ pred.confidence | number:'1.0-0' }}% confidence)
                      </p>
                      <small class="text-muted">{{ pred.timeframe }}</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
