<div class="executive-dashboard">
  <!-- Modern Dashboard Header -->
  <div class="dashboard-header">
    <!-- Background Animation Elements -->
    <div class="header-bg-animation">
      <div class="floating-orb orb-1"></div>
      <div class="floating-orb orb-2"></div>
      <div class="floating-orb orb-3"></div>
    </div>
    
    <!-- Header Content -->
    <div class="header-content">
      <!-- Title Section -->
      <div class="header-main">
        <div class="title-section">
          <div class="title-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>
            </svg>
          </div>
          <div class="title-content">
            <h1 class="dashboard-title">
              Executive Dashboard
              <span class="title-badge">LIVE</span>
            </h1>
            <p class="dashboard-subtitle">
              Real-time insights and performance analytics
              <span class="update-indicator" [class.pulse]="isLoading"></span>
            </p>
          </div>
        </div>
        
        <!-- Status Indicators -->
        <div class="status-section">
          <div class="status-item">
            <div class="status-dot status-active"></div>
            <span>System Online</span>
          </div>
          <div class="status-item">
            <div class="status-dot status-sync" [class.syncing]="isLoading"></div>
            <span>Data Sync</span>
          </div>
        </div>
      </div>
      
      <!-- Actions Section -->
      <div class="header-actions">
        <!-- Time Range Selector -->
        <div class="action-group">
          <label class="action-label" for="timeframe-select">Time Range</label>
          <div class="time-selector">
            <select [(ngModel)]="selectedTimeframe" (change)="onTimeframeChange()" class="modern-select" id="timeframe-select">
              <option value="7d">7 Days</option>
              <option value="30d">30 Days</option>
              <option value="90d">90 Days</option>
              <option value="1y">1 Year</option>
            </select>
            <div class="select-arrow">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 10l5 5 5-5z"/>
              </svg>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-group">
          <span class="action-label">Actions</span>
          <div class="button-group">
            <!-- Refresh Button -->
            <button class="action-btn refresh-btn" 
                    (click)="refreshDashboard()" 
                    [disabled]="isLoading"
                    [class.loading]="isLoading">
              <div class="btn-content">
                <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                </svg>
                <span class="btn-text">Refresh</span>
              </div>
            </button>
            
            <!-- Export Button -->
            <div class="export-dropdown" [class.open]="showExportMenu">
              <button class="action-btn export-btn" 
                      (click)="toggleExportMenu()"
                      [disabled]="isExporting"
                      [class.exporting]="isExporting">
                <div class="btn-content">
                  <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                  </svg>
                  <span class="btn-text" *ngIf="!isExporting">Export</span>
                  <span class="btn-text" *ngIf="isExporting">{{ exportingFormat }}...</span>
                </div>
              </button>
              
              <!-- Dropdown Menu -->
              <div class="export-menu" *ngIf="showExportMenu">
                <button class="export-option" (click)="exportDashboard(ExportFormats.PDF)" [disabled]="isExporting">
                  <div class="option-icon pdf">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                  </div>
                  <div class="option-content">
                    <span class="option-title">PDF Report</span>
                    <span class="option-desc">Complete dashboard export</span>
                  </div>
                </button>
                
                <button class="export-option" (click)="exportDashboard(ExportFormats.CSV)" [disabled]="isExporting">
                  <div class="option-icon csv">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                  </div>
                  <div class="option-content">
                    <span class="option-title">CSV Data</span>
                    <span class="option-desc">Raw data export</span>
                  </div>
                </button>
                
                <button class="export-option" (click)="exportDashboard(ExportFormats.JSON)" [disabled]="isExporting">
                  <div class="option-icon json">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path d="M5,3H7V5H5V10A2,2 0 0,1 3,12A2,2 0 0,1 5,14V19H7V21H5C3.93,20.73 3,20.1 3,19V15A2,2 0 0,0 1,13H0V11H1A2,2 0 0,0 3,9V5C3,3.9 3.9,3 5,3Z"/>
                    </svg>
                  </div>
                  <div class="option-content">
                    <span class="option-title">JSON API</span>
                    <span class="option-desc">Structured data</span>
                  </div>
                </button>
                
                <button class="export-option" (click)="exportDashboard(ExportFormats.PowerPoint)" [disabled]="isExporting">
                  <div class="option-icon ppt">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path d="M9,8V16H11V14H12.5A2.5,2.5 0 0,0 15,11.5A2.5,2.5 0 0,0 12.5,9H11V8H9M11,10H12.5A1.5,1.5 0 0,1 14,11.5A1.5,1.5 0 0,1 12.5,13H11V10Z"/>
                    </svg>
                  </div>
                  <div class="option-content">
                    <span class="option-title">PowerPoint</span>
                    <span class="option-desc">Presentation ready</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Last Update Info -->
    <div class="update-info">
      <div class="update-content">
        <span class="update-label">Last updated:</span>
        <span class="update-time">{{ lastRefresh | date:'MMM d, y â€¢ h:mm a' }}</span>
      </div>
      <div class="auto-refresh" *ngIf="autoRefreshEnabled">
        <div class="refresh-indicator"></div>
        <span>Auto-refresh active</span>
      </div>
    </div>
  </div>

  <!-- Export Notification -->
  <div *ngIf="exportNotification" class="alert alert-dismissible fade show" 
       [class]="'alert-' + (exportNotification.type === 'success' ? 'success' : exportNotification.type === 'error' ? 'danger' : 'info')" 
       role="alert">
    <i class="fas" 
       [class]="exportNotification.type === 'success' ? 'fa-check-circle' : exportNotification.type === 'error' ? 'fa-exclamation-triangle' : 'fa-info-circle'"></i>
    {{ exportNotification.message }}
    <button type="button" class="btn-close" (click)="clearNotification()" aria-label="Close"></button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && !dashboardData" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading dashboard data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle"></i>
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="refreshDashboard()">
      Try Again
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="dashboardData && !error" class="dashboard-content">
    
    <!-- KPI Cards Row -->
    <div class="row mb-4">
      <div class="col-md-2" *ngFor="let kpi of topKpis">
        <div class="card kpi-card h-100">
          <div class="card-body text-center">
            <div class="kpi-icon mb-2">
              <i class="fas fa-chart-bar text-primary"></i>
            </div>
            <h3 class="kpi-value mb-1" [class]="getKpiTrendColor(kpi)">
              {{ kpi.value | number:'1.0-2' }}
              <small class="kpi-unit">{{ kpi.unit }}</small>
            </h3>
            <p class="kpi-label text-muted mb-2">{{ kpi.name }}</p>
            <div class="kpi-trend">
              <i [class]="getTrendIcon(kpi.trend)"></i>
              <span [class]="getKpiTrendColor(kpi)">
                {{ kpi.changePercentage | number:'1.1-1' }}%
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Analytics Row -->
    <div class="row mb-4">
      <!-- Company Overview -->
      <div class="col-lg-4 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-building text-info"></i>
              Company Overview
            </h5>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-6 mb-3">
                <div class="metric-box">
                  <h4 class="text-primary">{{ dashboardData.companyOverview.totalReports }}</h4>
                  <small class="text-muted">Total Reports</small>
                </div>
              </div>
              <div class="col-6 mb-3">
                <div class="metric-box">
                  <h4 class="text-success">{{ dashboardData.companyOverview.overallEfficiency | number:'1.1-1' }}%</h4>
                  <small class="text-muted">Completion Rate</small>
                </div>
              </div>
              <div class="col-6 mb-3">
                <div class="metric-box">
                  <h4 class="text-info">{{ dashboardData.companyOverview.totalDepartments }}</h4>
                  <small class="text-muted">Departments</small>
                </div>
              </div>
              <div class="col-6 mb-3">
                <div class="metric-box">
                  <h4 class="text-warning">{{ dashboardData.companyOverview.activeUsers }}</h4>
                  <small class="text-muted">Active Users</small>
                </div>
              </div>
            </div>
            
            <!-- Enhanced Completion Rate Chart -->
            <div class="mt-3">
              <app-base-chart
                [type]="'doughnut'"
                [data]="completionRateData"
                [options]="completionRateOptions"
                [height]="'300px'"
                [isLoading]="isLoadingCharts"
                (chartClick)="onCompletionRateClick($event)"
                (chartReady)="onChartReady('completion', $event)">
              </app-base-chart>
            </div>
          </div>
        </div>
      </div>

      <!-- Department Performance -->
      <div class="col-lg-8 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-chart-bar text-success"></i>
              Department Performance
            </h5>
          </div>
          <div class="card-body">
            <!-- Enhanced Department Performance Chart -->
            <app-bar-chart
              [datasets]="[{
                label: 'Efficiency Score (%)',
                data: departmentPerformanceData,
                backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'],
                borderColor: ['#2563eb', '#059669', '#d97706', '#dc2626', '#7c3aed']
              }]"
              [options]="departmentPerformanceOptions"
              [height]="'350px'"
              [enableDrillDown]="true"
              [showActions]="true"
              [isLoading]="isLoadingCharts"
              (barClick)="onDepartmentPerformanceClick($event)"
              (chartReady)="onChartReady('department', $event)">
            </app-bar-chart>
          </div>
        </div>
      </div>
    </div>

    <!-- Trends and Alerts Row -->
    <div class="row mb-4">
      <!-- Recent Trends -->
      <div class="col-lg-8 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-line-chart text-primary"></i>
              Recent Trends
            </h5>
          </div>
          <div class="card-body">
            <!-- Enhanced Trends Chart -->
            <app-line-chart
              [datasets]="[{
                label: 'Performance Trends',
                data: trendsData,
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                fill: true
              }]"
              [options]="trendsOptions"
              [height]="'350px'"
              [showAreaFill]="true"
              [smooth]="true"
              [showDataPoints]="true"
              [isLoading]="isLoadingCharts"
              (chartReady)="onChartReady('trends', $event)">
            </app-line-chart>
          </div>
        </div>
      </div>

      <!-- Critical Alerts -->
      <div class="col-lg-4 mb-4">
        <div class="card h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
              <i class="fas fa-exclamation-triangle text-danger"></i>
              Critical Alerts
            </h5>
            <span class="badge bg-danger">{{ criticalAlerts.length }}</span>
          </div>
          <div class="card-body p-0">
            <div class="alerts-list">
              <div *ngIf="criticalAlerts.length === 0" class="text-center p-4 text-muted">
                <i class="fas fa-check-circle text-success fa-2x mb-2"></i>
                <p>No critical alerts</p>
              </div>
              <div *ngFor="let alert of criticalAlerts.slice(0, 5)" 
                   class="alert-item p-3 border-bottom" 
                   [class.alert-read]="alert.isRead"
                   (click)="markAlertAsRead(alert)">
                <div class="d-flex align-items-start">
                  <i [class]="getAlertIcon(alert.severity)" class="me-2 mt-1"></i>
                  <div class="flex-grow-1">
                    <h6 class="alert-title mb-1">{{ alert.title }}</h6>
                    <p class="alert-message text-muted mb-1">{{ alert.message }}</p>
                    <small class="alert-meta text-muted">
                      {{ alert.department }} â€¢ {{ alert.createdAt | date:'short' }}
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Performers and System Health -->
    <div class="row mb-4">
      <!-- Top Performers -->
      <div class="col-lg-6 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-trophy text-warning"></i>
              Top Performers
            </h5>
          </div>
          <div class="card-body">
            <div class="performers-list">
              <div *ngFor="let performer of dashboardData.topPerformers.slice(0, 5); let i = index" 
                   class="performer-item d-flex align-items-center mb-3">
                <div class="rank-badge me-3">
                  <span class="badge" [class]="i === 0 ? 'bg-warning' : i === 1 ? 'bg-secondary' : i === 2 ? 'bg-info' : 'bg-light text-dark'">
                    {{ performer.rank }}
                  </span>
                </div>
                <div class="flex-grow-1">
                  <h6 class="performer-name mb-1">{{ performer.userName }}</h6>
                  <small class="text-muted">{{ performer.departmentName }}</small>
                </div>
                <div class="text-end">
                  <div class="performer-metric">
                    <strong>{{ performer.completedReports }}</strong>
                    <small class="text-muted d-block">reports</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- System Health -->
      <div class="col-lg-6 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-heartbeat text-danger"></i>
              System Health
            </h5>
          </div>
          <div class="card-body">
            <div class="health-metrics">
              <div class="health-item d-flex justify-content-between align-items-center mb-3">
                <span>Overall Health</span>
                <span class="badge" [class]="'bg-' + (dashboardData.systemHealth.overallHealth === 'Healthy' ? 'success' : 'warning')">
                  {{ dashboardData.systemHealth.overallHealth }}
                </span>
              </div>
              <div class="health-item d-flex justify-content-between align-items-center mb-3">
                <span>Database</span>
                <span class="badge" [class]="'bg-' + (dashboardData.systemHealth.databaseHealth === 'Healthy' ? 'success' : 'warning')">
                  {{ dashboardData.systemHealth.databaseHealth }}
                </span>
              </div>
              <div class="health-item d-flex justify-content-between align-items-center mb-3">
                <span>API Health</span>
                <span class="badge" [class]="'bg-' + (dashboardData.systemHealth.apiHealth === 'Healthy' ? 'success' : 'warning')">
                  {{ dashboardData.systemHealth.apiHealth }}
                </span>
              </div>
              <div class="health-item d-flex justify-content-between align-items-center mb-3">
                <span>Email Service</span>
                <span class="badge" [class]="'bg-' + (dashboardData.systemHealth.emailServiceHealth === 'Healthy' ? 'success' : 'warning')">
                  {{ dashboardData.systemHealth.emailServiceHealth }}
                </span>
              </div>
              <hr>
              <div class="health-stats">
                <div class="row text-center">
                  <div class="col-4">
                    <h6 class="text-primary">{{ dashboardData.systemHealth.uptime | number:'1.1-1' }}%</h6>
                    <small class="text-muted">Uptime</small>
                  </div>
                  <div class="col-4">
                    <h6 class="text-success">{{ dashboardData.systemHealth.responseTime }}ms</h6>
                    <small class="text-muted">Response</small>
                  </div>
                  <div class="col-4">
                    <h6 class="text-warning">{{ dashboardData.systemHealth.errorRate | number:'1.2-2' }}%</h6>
                    <small class="text-muted">Error Rate</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Business Intelligence Section -->
    <div class="row" *ngIf="businessIntelligence">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-brain text-info"></i>
              Business Intelligence Insights
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <!-- Insights -->
              <div class="col-lg-4 mb-3">
                <h6 class="text-primary">Key Insights</h6>
                <div *ngFor="let insight of businessIntelligence.insights.slice(0, 3)" class="insight-item mb-2">
                  <div class="d-flex align-items-start">
                    <i class="fas fa-lightbulb text-warning me-2 mt-1"></i>
                    <div>
                      <strong>{{ insight.title }}</strong>
                      <p class="text-muted mb-0 small">{{ insight.description }}</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recommendations -->
              <div class="col-lg-4 mb-3">
                <h6 class="text-success">Recommendations</h6>
                <div *ngFor="let rec of businessIntelligence.recommendations.slice(0, 3)" class="recommendation-item mb-2">
                  <div class="d-flex align-items-start">
                    <i class="fas fa-star text-success me-2 mt-1"></i>
                    <div>
                      <strong>{{ rec.title }}</strong>
                      <p class="text-muted mb-0 small">{{ rec.description }}</p>
                      <span class="badge badge-sm" [class]="'bg-' + (rec.priority === 'High' ? 'danger' : rec.priority === 'Medium' ? 'warning' : 'secondary')">
                        {{ rec.priority }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Predictions -->
              <div class="col-lg-4 mb-3">
                <h6 class="text-info">Predictions</h6>
                <div *ngFor="let pred of businessIntelligence.predictions.slice(0, 3)" class="prediction-item mb-2">
                  <div class="d-flex align-items-start">
                    <i class="fas fa-crystal-ball text-info me-2 mt-1"></i>
                    <div>
                      <strong>{{ pred.metric }}</strong>
                      <p class="text-muted mb-0 small">
                        Expected: {{ pred.predictedValue | number:'1.0-2' }} 
                        ({{ pred.confidence | number:'1.0-0' }}% confidence)
                      </p>
                      <small class="text-muted">{{ pred.timeframe }}</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
